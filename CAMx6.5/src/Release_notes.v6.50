RELEASE NOTES for CAMx v6.50, 04/30/18

The Comprehensive Air Quality Model with extensions (CAMx) is available at
http://www.camx.com.  


Overview of Version 6.50
------------------------

V6.50 includes new features, modifications, and bug fixes from the previous
release (v6.40)

* Use the chemistry parameters files specifically labeled for v6.5.
  New files with new formats are available to support chemistry updates.
* The CAMx control namelist file has changed to support certain modifications.
* CAMx can now generate output files in netCDF (v3 or v4 with optional
  compression).  The original Fortran binary I/O format remains the default
  option.
* The CAMx makefile now supports:
  1) the option to compile with netCDF libraries
  2) the free Sun Oracle Fortran compiler with OMP support
  Type "make" or "make help" for more information.
  NOTE: RECENT VERSIONS OF THE GFORTRAN COMPILER WILL NOT COMPILE CAMx
        WITH OMP PARALLELIZATION BECAUSE OF AN INCOMPATIBILITY WITH BLOCK
        DATA IN ISORROPIA. THIS IS NOT AN ISSUE WITH OTHER SUPPORTED COMPILERS.
        OPTIONS:
        a) USE MPI ONLY WITH GFORTRAN
        b) REVERT BACK TO AN OLDER VERSION OF GFORTRAN
        c) USE A DIFFERENT COMPILER
* There are no changes to other I/O file formats from v6.40.


v6.50 New Features and Major Updates
------------------------------------

1. CAMx now supports netCDF for gridded output files, including the core model
   average concentration and deposition files, and Probing Tool output.

   Implications: netCDF is an option to the original Fortran binary I/O
                 format.  CAMx can be built with netCDF-3 or netCDF-4/HDF5; the
                 latter allows for data compression using "data chunking" -- use
                 default chunking settings, or test variations to check
                 compression impacts on your system.  See the Makefile
                 instructions on how to build CAMx with netCDF libraries.
                 Our implementation of uncompressed netCDF (v3 or v4) is
                 compatible with Models-3 I/O API convention without the need
                 to install and link with I/O API libraries.

2. The EQSAM ("4clim" version) for inorganic gas-aerosol partitioning has been
   added as an alternative to ISORROPIA.  Thanks to Swen Metzger at The Cyprus
   Institute and ResearchConcepts for supplying the code and assisting in its
   evaluation.

   Implications: EQSAM is based on analytical parameterizations, resulting in
                 slightly faster CAMx run times in our tests (4-7%).  PM 
                 concentration differences from ISORROPIA will depend on
                 specifics of each application.  We encourage tests comparing
                 results from both.

3. Chemical Process Analysis (CPA) has been extended to all gas-phase
   mechanisms.

   Implications: The inclusion of CPA calculations into the gas-phase mechanisms
                 was originally done by hand, which was time-intensive and
                 subject to coding errors.  These calculations are now
                 integrated into the Chemical Mechanism Compiler, which
                 automates the generation of all mechanism solver code and CPA
                 variable calculations.  Many CPA variables are now derived
                 using the same calculations as OSAT, improving the consistency
                 between these Probing Tools. 

4. The CAMx Makefile now supports the Oracle/Sun Fortran compiler with OMP.

   Implications: This free compiler adds to the list of supported compilers
                 for CAMx (PGF, IFORT, GFORTRAN, ABSOFT, ORACLE).


v6.50 Modifications
-------------------

1. A dry deposition parameter for ammonia (NH3) has been changed to more
   appropriately estimate NH3 removal rates.

   Implications:  The parameter "Rscale" in the CAMx chemistry parameters files
                  has been reset from "0" to "1".  The value strongly influences
                  NH3 deposition velocity by including (1) or ignoring (0) 
                  surface resistance.  Several tests with Rscale = 1 have shown
                  large increases (improvements) in NH3 concentrations.  We
                  recommend conducting sensitivity tests with Rscale = 0/1 for
                  NH3 to understand its impact on your particular application.

2. Precursor gas emissions for SOAP organic aerosol chemistry are now 
   automatically assigned from input CB05, CB6 or SAPRC07 VOC emissions as the
   model runs, removing the burden on the user to externally duplicate VOC
   emissions to make SOA precursor emissions.

   Implications: Up to now, CAMx required a duplicate set of VOC emissions
                 for certain species for use in the SOAP scheme (TOL->TOLA,
                 ISOP->ISP, etc.).  This step was burdensome and often errantly
                 skipped, leading to zero SOA production.  Now the burden is
                 removed and consistency between VOC and SOA precursor emissions
                 is ensured.

3. The treatment of Fe and Mn catalyzed aqueous SOx reactions has been
   reverted back to the original approach (prior to v6.40).

   Implications: The updated metal-catalyzed approach introduced in v6.40
                 (scaling Fe and Mn from FRCS+FPRM, etc.) significantly reduced
                 SO4 production, leading to under predictions.  The original
                 approach (setting Fe and Mn concentrations to a constant value)
                 is now the default until updates can be made and tested for a
                 later CAMx release.  The scaling approach in v6.40 remains in
                 the code and can be used with a simple parameter change.

4. SOAP2 has been updated with a new photolysis reaction (SOAP2.1). Only SOAP2
   yields, saturation concentrations and polymerization rates introduced in
   v6.4 are available (original SOAP1 parameters have been removed).

   Implications: Particle-phase SOA photolysis was implemented assuming a
                 photolysis lifetime of approximately one day.  The new removal
                 pathway, together with stronger SOA production based on wall-
                 corrected chamber yields introduced with SOAP2, led to better
                 agreement with observations in our tests.

5. Aerosol pH is now available as a part of CPA probing tool outputs providing
   better accessibility for the user.

   Implications: Aerosol pH, calculated by the thermodynamic equilibrium model
                 ISORROPIA, is now tracked through the model and output as a CPA
                 output variable (AER_PH).

6. ISORROPIA now employs the "metastable" liquid aerosol state assumption,
   instead of allowing a solid phase based on the deliquescence relative
   humidity.

   Implications: Under many atmospheric conditions, aerosols are more likely in
                 the metastable liquid state due to the hysteresis effect, and
                 recent ISORROPIA evaluation studies have shown that the
                 metastable assumption produced good agreement with field
                 observations.  At very low RH, however, this assumption may not
                 apply.

7. The chemistry parameters file header has been restructured to more clearly
   specify choice of gas-phase mechanisms, aerosol size scheme, and inorganic PM
   and SOA schemes/versions.

   Implications: These updates more clearly define the choice among the many
                 new gas and PM chemistry treatments.

8. Chemistry mechanisms CB6r2h and SAPRC07TC have been extended to include
   source apportionment.

   Implications: SA may now be run with CB6r2h and SAPRC07TC.  For CB6r2h,
                 ozone decay from reactions with oceanic halogens has been
                 added.  For SAPRC07TC, SA has been updated from SAPRC99, but
                 the SOA tracer class is not available and will be updated in
                 a later CAMx release.


v6.50 Bug Fixes
---------------

1. Fixed a bug in the RTRAC wet deposition algorithm.

   Implications: A check for the RTRAC surface model was missing, which led to
                 CAMx crashing with a segmentation fault if the surface model
                 was not invoked when running RTRAC.

2. Fixed a bug in the RTRAC dry deposition algorithm.

   Implications: The land/ocean mask update in v6.40 was not extended to the
                 RTRAC dry deposition algorithm, leading to CAMx crashing with
                 a segmentation fault when running RTRAC.

3. A check on the memory size of Probing Tool tracers has been added to avoid
   model crashes and cryptic fortran error messages.

   Implications: This check stops the model with an error message when the
                 Probing Tool tracer array dimension exceeds 2^31 values,
                 the maximum size of a single-precision integer.  Since this
                 value is much smaller than available machine memory, we plan to
                 extend the Probing Tool array dimension to a double-precision
                 integer in future releases.

4. Two infrequent bugs were fixed in MPI passing of data among MPI slices.

   Implications: (1) In certain rare circumstances and for very large
                 applications, message passing of boundary conditions was
                 impacted, leading to incorrect results relative to non-MPI
                 runs.  
                 (2) A fix alleviated segmentation violations when running MPI
                 with a large number of PiG puffs.
  
